{%- doc -%}
  Renders an "Add to cart" button with dynamic text and state. It shows different text based on whether the product can be added to the cart and provides visual feedback when an item is added.

  @param {boolean} can_add_to_cart - Whether the product can be added to the cart.
  @param {string} add_to_cart_text - The text to display on the button.
  @param {object} product - The product object to be added to the cart.
  @param {boolean} [icon_only_on_mobile] - If `true`, only the icon is shown on mobile devices.
  @param {string} [class] - Additional CSS classes to apply to the button.
  @param {string} [id] - The ID attribute for the button.
{%- enddoc -%}

{%- liquid
  assign default_add_to_cart_text = 'actions.add_to_cart' | t
  assign product_variant_media = product.selected_or_first_available_variant.featured_media.preview_image | image_url: width: 100
  if product.selected_or_first_available_variant.featured_media.preview_image == blank
    assign product_variant_media = product.featured_media.preview_image | image_url: width: 100
  endif
-%}

<add-to-cart-component
  ref="addToCartButtonContainer"
  data-product-variant-media="{{ product_variant_media }}"
  data-add-to-cart-animation="{{ settings.add_to_cart_animation }}"
>
  <button
    id="{{ id }}"
    type="submit"
    name="add"
    ref="addToCartButton"
    on:click="/handleClick"
    class="button {{ class }}"
    {% unless can_add_to_cart %}
      disabled
    {% endunless %}
  >
    <span class="add-to-cart-text">
      {% if can_add_to_cart %}

        {% comment %}
          COPIA DE SEGURIDAD - Así estaba anteriormente
            <span class="svg-wrapper add-to-cart-icon">
              {{- 'icon-add-to-cart.svg' | inline_asset_content -}}
            </span>
        {% endcomment %}

        {% comment %} Icono + para añadir al carrito de forma rápida {% endcomment %}
        <span class="svg-wrapper add-to-cart-icon">
          <svg width="24" height="24" viewBox="0 0 24 24">
            <line x1="12" y1="5" x2="12" y2="19" stroke="currentColor" stroke-width="2"/>
            <line x1="5" y1="12" x2="19" y2="12" stroke="currentColor" stroke-width="2"/>
          </svg>
        </span>

        <span class="add-to-cart-text__content{% if icon_only_on_mobile %} is-visually-hidden-mobile{% endif %}">
          {{- add_to_cart_text | default: default_add_to_cart_text -}}
        </span>
      {% endif %}

    </span>
    <span
      aria-hidden="true"
      class="add-to-cart-text--added"
    >
      <span class="svg-wrapper add-to-cart-icon--added">
        {{- 'icon-checkmark.svg' | inline_asset_content -}}
      </span>
      {% comment %}
      Quitamos el texto una vez se ha añadido el artículo al carrito, dejamos que solo se vea el icono de checkmark.
      
      <span class="{% if icon_only_on_mobile %}is-visually-hidden-mobile{% endif %}">
        {{- 'actions.added' | t -}}
      </span>
      {% endcomment %}

    </span>
  </button>
</add-to-cart-component>

{% stylesheet %}
  .add-to-cart-text {
    display: flex;
    gap: var(--gap-2xs);
    align-items: center;
    justify-content: center;
  }

  .add-to-cart-text--added {
    position: absolute;
    inset: 0;
    display: flex;
    align-items: center;
    justify-content: center;
    opacity: 0;
  }

  /* Centrar icono siempre */
.quick-add {
  display: flex !important;
  justify-content: center;
  align-items: center;
}

/* Deshabilitar animaciones y hover */
.quick-add__button .add-to-cart-text,
.quick-add__button .add-to-cart-text--added {
  animation: none !important;
  transition: none !important;
}

/* Evitar cambios por hover */
.quick-add__button:hover .add-to-cart-text,
.quick-add__button:hover .add-to-cart-text--added {
  transform: none !important;
  opacity: 1 !important;
}

/* Cuando se añade al carrito */
.quick-add__button.atc-added .add-to-cart-text {
  opacity: 0 !important; /* el + desaparece */
}

.quick-add__button.atc-added .add-to-cart-text--added {
  opacity: 1 !important; /* el tick aparece */
}

.add-to-cart-button {
  background-color: #1E1D1C;
  color: white;
  padding: 12px;
  border-radius: 0px;
  font-size: 16px;
  border: solid 1px transparent;
  transition: none;
}

.add-to-cart-button:hover {
  background-color: white;
  color: #1E1D1C;
  border: solid 1px #1E1D1C;
}


{% endstylesheet %}
